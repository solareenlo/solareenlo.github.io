<!DOCTYPE html>




<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  
    
    Kubernetes
  
 | solareenlo</title>


<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">



<link rel="stylesheet" href="/book.min.2e1d9daa3d2f72eb4cac24f3451f2b92bb2054c8b27e3256196500defa009cbf.css">


<link rel="icon" href="/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="https://solareenlo.com/">solareenlo</a>
</h2>



    
  
  
  

  <style>
  nav ul a[href$="\2f docs\2fkubernetes\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><a href="/"><strong>はじめに</strong></a></li>
<li><a href="/posts/"><strong>Blog</strong></a></li>
<li><a href="/docs/programming/"><strong>Programming</strong></a>

<ul>
<li><a href="/docs/terminal/">Terminal</a></li>
<li><a href="/docs/command/">Command</a></li>
<li><a href="/docs/shell-script/">Shell Script</a></li>
<li><a href="/docs/vim/">Vim</a></li>
<li><a href="/docs/git/">Git</a></li>
<li><a href="/docs/github/">GitHub</a></li>
</ul></li>
<li><a href="/docs/programming-language/"><strong>Programming Language</strong></a>

<ul>
<li><a href="/docs/c/">C</a></li>
<li><a href="/docs/rust/">Rust</a></li>
<li><a href="/docs/nodejs/">Node.js</a></li>
<li><a href="/docs/haskell/">Haskell</a></li>
<li><a href="/docs/angular/">Angular</a></li>
<li><a href="/docs/hugo/">Hugo</a></li>
</ul></li>
<li><a href="/docs/latex/"><strong>LaTeX</strong></a></li>
<li><a href="/docs/vps/"><strong>VPS</strong></a>

<ul>
<li><a href="/docs/ssh/">SSH</a></li>
<li><a href="/docs/ubuntu/">Ubuntu</a></li>
</ul></li>
<li><a href="/docs/db/"><strong>DB</strong></a>

<ul>
<li><a href="/docs/mysql/">MySQL</a></li>
<li><a href="/docs/mongodb/">MongoDB</a></li>
<li><a href="/docs/redis/">Redis</a></li>
</ul></li>
<li><a href="/docs/cloud/"><strong>Cloud</strong></a>

<ul>
<li><a href="/docs/aws/">AWS</a></li>
<li><a href="/docs/gcp/">GCP</a></li>
</ul></li>
<li><a href="/docs/ci-cd/"><strong>CI/CD</strong></a>

<ul>
<li><a href="/docs/jenkins/">Jenkins</a></li>
<li><a href="/docs/travis-ci/">Travis CI</a></li>
<li><a href="/docs/circleci/">CircleCI</a></li>
</ul></li>
<li><a href="/docs/container/"><strong>Container</strong></a>

<ul>
<li><a href="/docs/docker1/">Docker1</a></li>
<li><a href="/docs/docker2/">Docker2</a></li>
<li><a href="/docs/docker-compose/">Docker Compose</a></li>
<li><a href="/docs/kubernetes/">Kubernetes</a></li>
</ul></li>
<li><a href="/docs/crypto/"><strong>Crypto</strong></a>

<ul>
<li><a href="/docs/bitcoin/">Bitcoin</a></li>
<li><a href="/docs/ethereum/">Ethereum</a></li>
<li><a href="/docs/iota/">IOTA</a></li>
<li><a href="/docs/substrate/">Substrate</a></li>
<li><a href="/docs/white-paper/">White Paper</a></li>
</ul></li>
</ul>





</nav>


  
<script>
(function() {
  var menu = document.querySelector('aside.book-menu nav')
  addEventListener('beforeunload', function(event) {
    localStorage.setItem('menu.scrollTop', menu.scrollTop)
  });
  menu.scrollTop = localStorage.getItem('menu.scrollTop')
})()
</script>



    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>
  
    
    Kubernetes
  
</strong>
</header>

      
<article class="markdown">

<h1 id="kubernetes-https-github-com-kubernetes-とは"><a href="https://github.com/kubernetes">Kubernetes</a>とは</h1>

<p>Dockerコンテナのクラスタ管理を始めとしたオーケストレーションを行うサービスのこと.
ホスト間の連携やデプロイについても総括的に管理できる(ここがDocker Composeと違うところ).<br />
<strong>Reference:</strong> <a href="https://speakerdeck.com/kkoudev/introduction-to-kubernetes-for-docker-compose-user">Docker Compose利用者から見た Kubernetes 開発環境構築入門</a></p>

<p>Kubernetesの大きな特徴の1つに宣言的設定がある.
宣言的設定とは, イミュータブルなインフラを作るための基本的な考え方で, 「システムのあるべき姿」を設定ファイルに宣言する！という考え方.
Kubernetesは設定ファイルに書いたとおりのインフラを維持するように設計されている.
ので, 設定ファイル(yamlファイル)をたくさん書く事になる.</p>

<h2 id="他のオーケストレーションと違うところ">他のオーケストレーションと違うところ</h2>

<p>① 様々なOSSと組み合わせることにより, 柔軟に機能拡張なところ.</p>

<ul>
<li>コンテナ運用を更に効率化 / 高速化

<ul>
<li>詳細なメトリック監視と可視化・・・Prometheus + Grafana</li>
<li>コンテナのログの転送収集・・・Fluentd / Fluent Bit</li>
<li>ネットワークトラフィックの制御・・・ Istio + Envoy</li>
</ul></li>
<li>Kubernetesの適応領域の拡大

<ul>
<li>機械学習プラットフォーム・・・Kubeflow</li>
<li>分散ストレージ・・・Rook</li>
<li>分散型データベース・・・Vitess</li>
</ul></li>
</ul>

<p>② 本格的な宣言的オペレーションとInfrastructure as Codeを実現可能</p>

<p>③ クラスター上にデプロイするシステムの構成をコード(マニフェストファイル)によって定義できる</p>

<ul>
<li>運用オペレーションはコードの変更によって実施し, 作業を簡素化する.</li>
<li>複数Kubernetesクラスターでの相互運用を実現する</li>
</ul>

<p><strong>Reference:</strong> <a href="https://crash.academy/ng/video/731/2060">Kubernetesの基礎</a></p>

<h2 id="docker-composeとの違い">Docker Composeとの違い</h2>

<p>Docker Composeは動作させるコンテナを意識するだけでほとんど良かったが, Kubernetesではそれに加えて動作させるホスト(Node)やコンテナのグループ化(Pod), その複製(ReplicaSet)と公開(Service, Ingress)といったインフラレベルで意識していたことも全て設定ファイルの1つとして管理できる.<br />
<strong>Reference:</strong> <a href="https://speakerdeck.com/kkoudev/introduction-to-kubernetes-for-docker-compose-user">Docker Compose利用者から見た Kubernetes 開発環境構築入門</a></p>

<table>
<thead>
<tr>
<th>項目</th>
<th>Docker Compose</th>
<th>→</th>
<th>Kubernetes</th>
</tr>
</thead>

<tbody>
<tr>
<td>Image</td>
<td>各エントリーは, イメージを構築するためにオプションでdocker-composeを取得できる.</td>
<td>→</td>
<td>すべてのイメージがすでに構築されているとする.</td>
</tr>

<tr>
<td>Container</td>
<td>各エントリーが作成したいコンテナを表す.</td>
<td>→</td>
<td>作成したいオブジェクト(Kubernetesクラスタ上で機能する構成要素のこと. Pod, Service, Volume, Namespace, Controllerのこと.)ごとに1つの設定ファイル</td>
</tr>

<tr>
<td>Network</td>
<td>各エントリがネットワーク要件を定義する.</td>
<td>→</td>
<td>手動ですべてのネットワークを設定する必要がある.</td>
</tr>
</tbody>
</table>

<h2 id="用語集">用語集</h2>

<table>
<thead>
<tr>
<th>用語</th>
<th>説明</th>
</tr>
</thead>

<tbody>
<tr>
<td>Node</td>
<td>コンテナが動作するサーバのこと.<br><li>Master(Master Node): 全Nodeを管理する.<li>Node(Woker Node): 各リソースを動かす.</td>
</tr>

<tr>
<td>Pod</td>
<td>関連したコンテナの集まりを1つにしたもの.</td>
</tr>

<tr>
<td>ReplicaSet</td>
<td>対象Podのクラスタ全体における生成・管理を行う.<br>PodTemplateと呼ばれるPodのテンプレートをもとに、Podを指定された数(レプリカ数)に調整・管理を行う仕組み.<br>そうすることで, Podのセルフヒーリングを行う.</td>
</tr>

<tr>
<td>Deployment</td>
<td>ReplicaSetの生成・管理を行う.<br>ローリングアップデートやロールバックといったデプロイ管理の仕組みを提供する.</td>
</tr>

<tr>
<td>Service</td>
<td>Podへのアクセス経路を提供する.<br>OSI参照モデルのL4層まで扱える.<br>- クラスタ内部のみで利用できるService(ClusterIP)や,<br>- クラスタ外部からアクセス可能なService(NodePort)などを作成することができる.</td>
</tr>

<tr>
<td>Ingress</td>
<td>Serviceの上位リソース.<br>OSI参照モデルのL7層レベルまで扱える.</td>
</tr>

<tr>
<td>ConfigMap</td>
<td>環境変数のような設定値, また設定ファイル情報そのものを管理する.<br>Key-Value形式.</td>
</tr>

<tr>
<td>Secret</td>
<td>パスワードのような秘匿情報を扱う際に利用する.</td>
</tr>

<tr>
<td>PersistentVolume</td>
<td>ボリューム領域を定義する.<br>EBSやNFSのような外部ストレージも定義できる.</td>
</tr>

<tr>
<td>PersistentVolumeClaim</td>
<td>利用するボリューム領域の要求を定義する.<br>PersistentVolumeとPodを紐付けるために利用する.</td>
</tr>

<tr>
<td>Namespace</td>
<td>仮想的なKubernetesクラスタの分離機能.<br><li><strong>default</strong>: デフォルトのNamespace<li><strong>kube-system</strong>: Kubernetesクラスタのコンポーネントやaddonが展開されるNamespace<li><strong>kube-public</strong>: 全ユーザが利用できるConfigMapなどを配置するNamespace</td>
</tr>
</tbody>
</table>

<ul>
<li><strong>References:</strong>

<ul>
<li><a href="https://qiita.com/tkusumi/items/01cd18c59b742eebdc6a">Kubernetes: Deployment の仕組み</a></li>
<li><a href="https://speakerdeck.com/kkoudev/introduction-to-kubernetes-for-docker-compose-user">Docker Compose利用者から見た Kubernetes 開発環境構築入門</a></li>
</ul></li>
</ul>

<h2 id="yaml内の用語集">yaml内の用語集</h2>

<table>
<thead>
<tr>
<th>用語</th>
<th>意味</th>
</tr>
</thead>

<tbody>
<tr>
<td>apiVersion</td>
<td>リソースで利用するAPIのバージョンを指定.</td>
</tr>

<tr>
<td>kind</td>
<td>リソースの種別を指定.<br>(Deployment, Serviceとか)</td>
</tr>

<tr>
<td>metadata</td>
<td>リソースへ付与可能なメタデータ.<br>主に名称やラベルを付与する.</td>
</tr>

<tr>
<td>spec</td>
<td>リソース固定の設定を指定.</td>
</tr>

<tr>
<td>data</td>
<td>ConfigMapやSecretなどの設定データを記述するリソースで使用される.</td>
</tr>

<tr>
<td>label</td>
<td>Kubernetes上のオブジェクト(Podなど)に付けることができるKey/Valueペアの文字列で, オブジェクトに任意のメタ情報のようなものを持たせることができる.</td>
</tr>

<tr>
<td>selector</td>
<td>Labelの集合をもとにKubernetesオブジェクトをフィルタリングすることができる.</td>
</tr>
</tbody>
</table>

<h3 id="apiversionの調べ方">apiVersionの調べ方</h3>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl api-resources <span style="color:#586e75"># リソースとAPIGROUPの対応を調べる</span>
kubectl api-versions <span style="color:#586e75"># APIGROUPで利用可能なversionを調べる</span></code></pre></div>
<table>
<thead>
<tr>
<th>APIGROUPあるなし</th>
<th></th>
<th>書き方</th>
</tr>
</thead>

<tbody>
<tr>
<td>APIGROUPがあるとき</td>
<td>→</td>
<td>apiVersion: (APIGROUP)/(APIVERSION)</td>
</tr>

<tr>
<td>APIGROUPがないとき(= Core groupに属する)</td>
<td>→</td>
<td>apiVersion: v1</td>
</tr>
</tbody>
</table>

<p><strong>Reference:</strong> <a href="https://qiita.com/soymsk/items/69aeaa7945fe1f875822">Kubernetesの apiVersion に何を書けばいいか</a></p>

<h3 id="serviceのtype4種類">ServiceのType4種類</h3>

<ul>
<li><strong>ClusterIp</strong>

<ul>
<li>クラスタ内のIPにServiceを公開する.</li>
<li>この値ではServiceはクラスタ内からのみアクセス可能.</li>
<li>デフォルトはこれ.</li>
</ul></li>
<li><strong>NodePort</strong>

<ul>
<li>各ノードのIP上のServiceを静的ポート(NordPort)に公開する.</li>
<li>NodePort ServiceがルーティングするClusterIP Serviceが自動的に作成される.</li>
<li><code>NodeIp: NordPort</code>を要求することで, クラスタ外からNordPort Serviceにアクセスできる.</li>
</ul></li>
<li><strong>LoadBalancer</strong>

<ul>
<li>クラウドプロバイダのロードバランサを使用して外部にServiceを公開する.</li>
<li>外部ロードバランサがルーティングするNordPort ServiceとClusterIP Serviceが自動的に作成される.</li>
</ul></li>
<li><strong>ExternalName</strong>

<ul>
<li>値を含むCNAMEレコードを返すことにより, ServiceをexternalNameフィールドのコンテンツ(たとえば, foo.bar.example.com)にマッピングする.</li>
<li>この場合, どのような種類のプロキシも設定されない.</li>
<li>この型を使うには, バージョン1.7以上のkube-dnsが必要.</li>
</ul></li>
</ul>

<p><strong>Reference:</strong> <a href="https://qiita.com/kouares/items/94a073baed9dffe86ea0">Kubernetesの Service についてまとめてみた</a></p>

<h3 id="persistentvolumeclaimのaccessmodes3種類">PersistentVolumeClaimのaccessModes3種類</h3>

<ul>
<li><strong>PeadWriteOnce</strong>

<ul>
<li>1つのノードが読み書き可能</li>
</ul></li>
<li><strong>ReadOnlyMany</strong>

<ul>
<li>複数のノードが読み込みだけ可能</li>
</ul></li>
<li><strong>ReadWriteMany</strong>

<ul>
<li>複数のノードから読み書き可能</li>
</ul></li>
</ul>

<h3 id="storageclassの一覧">StorageClassの一覧</h3>

<ul>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#the-storageclass-resource">The StorageClass Resource</a></li>
</ul>

<h3 id="volumemountsのsubpath">volumeMountsのsubPath</h3>

<p><code>subPath</code>を指定してあげると<code>volume</code>をルートディレクトリからマウントしないで, サブディレクトリからマウントする.
<code>volume</code>をそんなに使わない時にオススメ.</p>

<p><strong>Reference:</strong> <a href="https://qiita.com/MahoTakara/items/fbe5ffb9fd9b9d35ddbe">永続ストレージのサブディレクトリにマウントする方法</a></p>

<h2 id="macのローカル環境で動かす">Macのローカル環境で動かす</h2>

<ol>
<li><a href="https://brew.sh">https://brew.sh</a> からbrewをインストールする.</li>
<li><code>brew install kubernetes-cli</code>をターミナルで実行する.

<ul>
<li><code>kubectl</code>はKubernetesのmasterを動かすもの.</li>
</ul></li>
<li><a href="https://www.virtualbox.org">https://www.virtualbox.org</a> からMac用のVirtualBoxをインストールする.

<ul>
<li>VirtualBoxはコンテナ群を動かす環境.</li>
</ul></li>
<li><code>brew cask install minikube</code>をターミナルで実行する.

<ul>
<li><code>minikube</code>はコンテナをVM上で動かすもの.</li>
</ul></li>
<li><code>minikube start</code>をターミナルで実行する.</li>
</ol>

<ul>
<li><strong>References:</strong>

<ul>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></li>
<li><a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-minikube/">https://kubernetes.io/docs/tasks/tools/install-minikube/</a></li>
</ul></li>
</ul>

<h2 id="ubuntuのローカル環境で動かす">Ubuntuのローカル環境で動かす</h2>

<ol>
<li><code>kubectl</code>をインストールする.</li>
<li>VirtualBoxをインストールする.</li>
<li><code>minikube</code>をインストールする.</li>
</ol>

<ul>
<li><strong>References:</strong>

<ul>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></li>
<li><a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-minikube/">https://kubernetes.io/docs/tasks/tools/install-minikube/</a></li>
</ul></li>
</ul>

<h3 id="minikube-の使い方"><code>minikube</code>の使い方</h3>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">minikube status <span style="color:#586e75"># 動いているか確認</span>
minikube start <span style="color:#586e75"># minikubeをスタート</span>
minikube ip <span style="color:#586e75"># ipを確認</span>
minikube dashboard <span style="color:#586e75"># ダッシュボード出現</span>
minikube docker-env <span style="color:#586e75"># 環境変数を出力</span></code></pre></div>
<h3 id="kubectl-の使い方"><code>kubectl</code>の使い方</h3>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f client-pod.yaml <span style="color:#586e75"># オブジェクトの新規作成・差分反映</span>
kubectl get pods <span style="color:#586e75"># 動いているpodを確認</span>
kubectl get deployments <span style="color:#586e75"># 動いているdeploymentを確認</span>
kubectl describe &lt;object type&gt; &lt;object name&gt; <span style="color:#586e75"># オブジェクトの詳細表示</span>
kubectl delete -f client-pod.yaml <span style="color:#586e75"># オブジェクトが存在すれば削除</span>
kubectl delete deployment client-deployment <span style="color:#586e75"># deploymentの削除</span>
kubectl delete pod client-node-port <span style="color:#586e75"># podの削除</span>
kubectl api-resources <span style="color:#586e75"># リソースとAPIGROUPの対応を調べる</span>
kubectl api-versions <span style="color:#586e75"># APIGROUPで利用可能なversionを調べる</span>
kubectl get storageclass <span style="color:#586e75"># 管理者が提供するストレージのクラスを表示</span>
kubectl get pv <span style="color:#586e75"># PersistentVolumeの一覧を表示</span>
kubectl get pvc <span style="color:#586e75"># PersistentVolumeClaimの一覧を表示</span>
<span style="color:#586e75"># 以下3つはパスワードを設定する時に使用</span>
kubectl create secret generic pgpassword --from-literal <span style="color:#268bd2">PGPASSWORD</span><span style="color:#719e07">=</span>******** <span style="color:#586e75"># パスワードを生成</span>
kubectl create secret generic &lt;secret_name&gt; --from-literal &lt;<span style="color:#268bd2">key</span><span style="color:#719e07">=</span>value&gt; <span style="color:#586e75"># パスワードを生成</span>
kubectl get secret <span style="color:#586e75"># secret一覧を表示</span>
<span style="color:#586e75"># 以下2つはGKEでユーザーの権限を与える時に使用</span>
kubectl create serviceaccount --namespace kube-system tiller <span style="color:#586e75"># tillerというサービスアカウントを作成</span>
kubectl create clusterrolebinding tiller-cluster-rule --clusterrole<span style="color:#719e07">=</span>cluster-ad
min --serviceaccount<span style="color:#719e07">=</span>kube-system:tiller</code></pre></div>
<h3 id="自分のpcからvmにアクセスしてdockerコンテナを見る方法">自分のPCからVMにアクセスしてDockerコンテナを見る方法</h3>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#b58900">eval</span> <span style="color:#719e07">$(</span>minikube docker-env<span style="color:#719e07">)</span>
docker ps</code></pre></div>
<h2 id="1度デプロイしたイメージのバージョンアップ方法">1度デプロイしたイメージのバージョンアップ方法</h2>

<p>Kubernetesでは<code>latest</code>タグイメージの運用は適切なロールバックを行うことが難しいので推奨されていない.<br />
ので, できる限り<code>Vsersion</code>, もしくは<code>digest</code>でイメージ指定を行うようにする.</p>

<p>以下のようにDocker Hubにバージョンを指定してpushし,</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build -t solareenlo/multi-client:v5
docker push solareenlo/multi-client:v5</code></pre></div>
<p>以下のようにコマンドラインからイメージのバージョンアップを行う.</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl <span style="color:#b58900">set</span> image deployment/client-deployment <span style="color:#268bd2">client</span><span style="color:#719e07">=</span>solareenlo/multi-client:v5</code></pre></div>
<h2 id="イメージのバージョンにgitのshaを使う">イメージのバージョンにgitのshaを使う</h2>

<p>以下の様に<code>.travis.yml</code>に<code>$SHA</code>を設定して,</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">sudo: required
services:
  - docker
env:
  global:
    - SHA=$(git rev-parse HEAD)</code></pre></div>
<p>以下の様に<code>build</code>, <code>push</code>, <code>set</code>を行うと良い.</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build -t solareenlo/multi-client:latest -t solareenlo/multi-client:<span style="color:#268bd2">$SHA</span> -f ./client/Dockerfile ./client
docker build -t solareenlo/multi-server:latest -t solareenlo/multi-server:<span style="color:#268bd2">$SHA</span> -f ./server/Dockerfile ./server
docker build -t solareenlo/multi-worker:latest -t solareenlo/multi-worker:<span style="color:#268bd2">$SHA</span> -f ./worker/Dockerfile ./worker

docker push solareenlo/multi-client:latest
docker push solareenlo/multi-server:latest
docker push solareenlo/multi-worker:latest

docker push solareenlo/multi-client:<span style="color:#268bd2">$SHA</span>
docker push solareenlo/multi-server:<span style="color:#268bd2">$SHA</span>
docker push solareenlo/multi-worker:<span style="color:#268bd2">$SHA</span>

kubectl apply -f k8s
kubectl <span style="color:#b58900">set</span> image solareenlo/server-deployment <span style="color:#268bd2">server</span><span style="color:#719e07">=</span>solareenlo/multi-server:<span style="color:#268bd2">$SHA</span>
kubectl <span style="color:#b58900">set</span> image solareenlo/client-deployment <span style="color:#268bd2">client</span><span style="color:#719e07">=</span>solareenlo/multi-client:<span style="color:#268bd2">$SHA</span>
kubectl <span style="color:#b58900">set</span> image solareenlo/worker-deployment <span style="color:#268bd2">worker</span><span style="color:#719e07">=</span>solareenlo/multi-worker:<span style="color:#268bd2">$SHA</span></code></pre></div>
<h2 id="ローカルで動かした例">ローカルで動かした例</h2>

<ul>
<li><a href="https://github.com/solareenlo/complex-k8s-local">solareenlo/complex-k8s-local</a></li>
</ul>

<h2 id="gkeで動かした例">GKEで動かした例</h2>

<ul>
<li><a href="https://github.com/solareenlo/multi-k8s-gke">solareenlo/multi-k8s-gke</a></li>
</ul>

<h2 id="tls">TLS</h2>

<ul>
<li><a href="https://github.com/jetstack/cert-manager">jetstack/cert-manager</a></li>
</ul>

<h1 id="helm-https-github-com-helm-helm"><a href="https://github.com/helm/helm">Helm</a></h1>

<p>Kubernetesのパッケージ管理ツールのこと.<br />
デフォルトで使用可能なChartは<code>kubernetes/charts</code>の<code>stable</code>ディレクトリで確認可能.</p>

<table>
<thead>
<tr>
<th>用語</th>
<th>意味</th>
<th>役割</th>
</tr>
</thead>

<tbody>
<tr>
<td>helm</td>
<td>船のかじ</td>
<td>Kubernetesのパッケージマネージャー.</td>
</tr>

<tr>
<td>chart</td>
<td>海図</td>
<td>Kubernetesのマニフェストのテンプレートをまとめたもの.</td>
</tr>

<tr>
<td>tiller</td>
<td>舵柄</td>
<td>デプロイを担うサーバーコンポーネント.</td>
</tr>

<tr>
<td>package</td>
<td>-</td>
<td>1つのアプリケーションとして成り立つchartの単位.<br>この単位でデプロイを行う.</td>
</tr>

<tr>
<td>release</td>
<td>-</td>
<td>packageがデプロイされて, k8s上でpodとして実際に動作しているもの.</td>
</tr>

<tr>
<td>repository</td>
<td>-</td>
<td>chartの置き場所. yumのリポジトリのようなイメージ.</td>
</tr>
</tbody>
</table>

<ul>
<li><strong>Reference:</strong>

<ul>
<li><a href="https://qiita.com/tkusumi/items/12857780d8c8463f9b9c">Kubernetes: パッケージマネージャHelm</a></li>
<li><a href="https://y-ohgi.hatenablog.com/entry/2018/05/21/010839">helm覚書</a></li>
<li><a href="https://qiita.com/Ladicle/items/63cad824e27aa8aac7e1#構成と通信方法">helmの過去、現在、未来</a></li>
<li><a href="https://qiita.com/thinksphere/items/5f3e918015cf4e63a0bc">Helmの概要とChart(チャート)の作り方</a></li>
</ul></li>
</ul>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    
    <a href="https://github.com/solareenlo/blog-hugo/commit/bfdb11d6c824e80d10aa1d17d0ca2e572371e417" title='Last modified May 5, 2019 by solareenlo' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" alt="Changed" /> May 5, 2019
    </a>
  </div>
  
  
  <div>
    <a href="https://github.com/solareenlo/blog-hugo/edit/master/content/docs/kubernetes.md" target="_blank" rel="noopener">
      <img src="/svg/code-fork.svg" alt="Edit" /> Edit this page
    </a>
  </div>
  
</div>


      
    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#kubernetes-https-github-com-kubernetes-とは"><a href="https://github.com/kubernetes">Kubernetes</a>とは</a>
<ul>
<li><a href="#他のオーケストレーションと違うところ">他のオーケストレーションと違うところ</a></li>
<li><a href="#docker-composeとの違い">Docker Composeとの違い</a></li>
<li><a href="#用語集">用語集</a></li>
<li><a href="#yaml内の用語集">yaml内の用語集</a>
<ul>
<li><a href="#apiversionの調べ方">apiVersionの調べ方</a></li>
<li><a href="#serviceのtype4種類">ServiceのType4種類</a></li>
<li><a href="#persistentvolumeclaimのaccessmodes3種類">PersistentVolumeClaimのaccessModes3種類</a></li>
<li><a href="#storageclassの一覧">StorageClassの一覧</a></li>
<li><a href="#volumemountsのsubpath">volumeMountsのsubPath</a></li>
</ul></li>
<li><a href="#macのローカル環境で動かす">Macのローカル環境で動かす</a></li>
<li><a href="#ubuntuのローカル環境で動かす">Ubuntuのローカル環境で動かす</a>
<ul>
<li><a href="#minikube-の使い方"><code>minikube</code>の使い方</a></li>
<li><a href="#kubectl-の使い方"><code>kubectl</code>の使い方</a></li>
<li><a href="#自分のpcからvmにアクセスしてdockerコンテナを見る方法">自分のPCからVMにアクセスしてDockerコンテナを見る方法</a></li>
</ul></li>
<li><a href="#1度デプロイしたイメージのバージョンアップ方法">1度デプロイしたイメージのバージョンアップ方法</a></li>
<li><a href="#イメージのバージョンにgitのshaを使う">イメージのバージョンにgitのshaを使う</a></li>
<li><a href="#ローカルで動かした例">ローカルで動かした例</a></li>
<li><a href="#gkeで動かした例">GKEで動かした例</a></li>
<li><a href="#tls">TLS</a></li>
</ul></li>
<li><a href="#helm-https-github-com-helm-helm"><a href="https://github.com/helm/helm">Helm</a></a></li>
</ul>
</nav>
  </aside>



  </main>
  
  
  
</body>

</html>
